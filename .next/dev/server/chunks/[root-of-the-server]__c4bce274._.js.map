{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/kishoremadhavan/Desktop/Wraptron-Tool/Lanchpad-Nirmaan/incubation-frontend/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\n// Server-side Supabase client using the service role key so that\n// API routes can read/write tables directly without depending on the\n// separate backend service. Falls back to the public keys in case\n// environment variables are missing to keep local development working.\nconst supabaseUrl =\n  process.env.SUPABASE_URL ||\n  process.env.NEXT_PUBLIC_SUPABASE_URL ||\n  \"https://dfzfmtthyvwltwwmntmd.supabase.co\";\n\nconst supabaseServiceRoleKey =\n  process.env.SUPABASE_SERVICE_ROLE_KEY ||\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n  \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRmemZtdHRoeXZ3bHR3d21udG1kIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQwNDk0NiwiZXhwIjoyMDgzOTgwOTQ2fQ.m8DKbf04d5Awu99sYyTIpv15xvnkoXV3WTOlk4GP8HE\";\n\nexport const supabaseServer = createClient(supabaseUrl, supabaseServiceRoleKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false,\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,iEAAiE;AACjE,qEAAqE;AACrE,kEAAkE;AAClE,uEAAuE;AACvE,MAAM,cACJ,QAAQ,GAAG,CAAC,YAAY,oFAExB;AAEF,MAAM,yBACJ,QAAQ,GAAG,CAAC,yBAAyB,uQAErC;AAEK,MAAM,iBAAiB,IAAA,0NAAY,EAAC,aAAa,wBAAwB;IAC9E,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///Users/kishoremadhavan/Desktop/Wraptron-Tool/Lanchpad-Nirmaan/incubation-frontend/app/api/apply/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { supabaseServer } from \"@/lib/supabaseServer\";\n\n/* =========================\n   POST: Submit application\n========================= */\nexport async function POST(request: NextRequest) {\n  try {\n    // Parse FormData instead of JSON (for file uploads)\n    const formData = await request.formData();\n    \n    // Convert FormData to a regular object\n    const body: Record<string, any> = {};\n    formData.forEach((value, key) => {\n      // Skip file fields\n      if (key.endsWith('File')) {\n        body[key] = value;\n      } else {\n        body[key] = value.toString();\n      }\n    });\n\n    // Validate required fields based on database schema (NOT NULL constraints)\n    const requiredFields = [\n      \"email\",\n      \"teamName\",\n      \"yourName\",\n      \"isIITM\",\n      \"rollNumber\",\n      \"phoneNumber\",\n      \"channel\",\n      \"coFoundersCount\",\n      \"priorEntrepreneurshipExperience\",\n      \"teamPriorEntrepreneurshipExperience\",\n      \"mcaRegistered\",\n      \"teamMembers\",\n      \"nirmaanCanHelp\",\n      \"preIncubationReason\",\n      \"heardAboutStartups\",\n      \"heardAboutNirmaan\",\n      \"problemSolving\",\n      \"yourSolution\",\n      \"solutionType\",\n      \"targetIndustry\",\n      \"startupStage\",\n      \"hasIntellectualProperty\",\n      \"hasPotentialIntellectualProperty\",\n      \"nirmaanPresentationLink\",\n      \"hasProofOfConcept\",\n      \"hasPatentsOrPapers\",\n      \"seedFundUtilizationPlan\",\n      \"pitchVideoLink\",\n    ];\n\n    for (const field of requiredFields) {\n      if (!body[field] || String(body[field]).trim() === \"\") {\n        return NextResponse.json(\n          { error: `Missing required field: ${field}` },\n          { status: 400 }\n        );\n      }\n    }\n\n    // Handle file uploads to Supabase Storage\n    const fileUrls: Record<string, string> = {};\n    \n    // Upload presentation file\n    if (body.presentationFile && body.presentationFile instanceof File) {\n      const file = body.presentationFile as File;\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${Date.now()}-presentation.${fileExt}`;\n      const filePath = `applications/${fileName}`;\n      \n      const { data: uploadData, error: uploadError } = await supabaseServer\n        .storage\n        .from('application-files')\n        .upload(filePath, file);\n      \n      if (!uploadError && uploadData) {\n        const { data: { publicUrl } } = supabaseServer\n          .storage\n          .from('application-files')\n          .getPublicUrl(filePath);\n        fileUrls.presentation = publicUrl;\n      }\n    }\n    \n    // Upload document files\n    if (body.document1File && body.document1File instanceof File) {\n      const file = body.document1File as File;\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${Date.now()}-doc1.${fileExt}`;\n      const filePath = `applications/${fileName}`;\n      \n      const { data: uploadData, error: uploadError } = await supabaseServer\n        .storage\n        .from('application-files')\n        .upload(filePath, file);\n      \n      if (!uploadError && uploadData) {\n        const { data: { publicUrl } } = supabaseServer\n          .storage\n          .from('application-files')\n          .getPublicUrl(filePath);\n        fileUrls.document1 = publicUrl;\n      }\n    }\n    \n    if (body.document2File && body.document2File instanceof File) {\n      const file = body.document2File as File;\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${Date.now()}-doc2.${fileExt}`;\n      const filePath = `applications/${fileName}`;\n      \n      const { data: uploadData, error: uploadError } = await supabaseServer\n        .storage\n        .from('application-files')\n        .upload(filePath, file);\n      \n      if (!uploadError && uploadData) {\n        const { data: { publicUrl } } = supabaseServer\n          .storage\n          .from('application-files')\n          .getPublicUrl(filePath);\n        fileUrls.document2 = publicUrl;\n      }\n    }\n\n    // Parse JSONB fields if they're strings\n    let otherIndustries = body.otherIndustries;\n    if (typeof otherIndustries === 'string') {\n      try {\n        otherIndustries = JSON.parse(otherIndustries);\n      } catch {\n        otherIndustries = [];\n      }\n    }\n    \n    let technologiesUtilized = body.technologiesUtilized;\n    if (typeof technologiesUtilized === 'string') {\n      try {\n        technologiesUtilized = JSON.parse(technologiesUtilized);\n      } catch {\n        technologiesUtilized = [];\n      }\n    }\n\n    // Map ALL frontend fields to database fields matching the new_application schema\n    const applicationData: Record<string, any> = {\n      // Basic Information\n      email: body.email,\n      team_name: body.teamName || \"N/A\",\n      your_name: body.yourName || \"N/A\",\n      is_iitm: body.isIITM || \"No\",\n      roll_number: body.rollNumber || \"N/A\",\n      roll_number_other: body.rollNumberOther || null,\n      college_name: body.collegeName || null,\n      current_occupation: body.currentOccupation || null,\n      phone_number: body.phoneNumber || \"N/A\",\n      channel: body.channel || \"N/A\",\n      channel_other: body.channelOther || null,\n      co_founders_count: parseInt(body.coFoundersCount) || 0,\n      faculty_involved: body.facultyInvolved || null,\n\n      // Entrepreneurship Experience\n      prior_entrepreneurship_experience: body.priorEntrepreneurshipExperience || \"No\",\n      team_prior_entrepreneurship_experience: body.teamPriorEntrepreneurshipExperience || \"No\",\n      prior_experience_details: body.priorExperienceDetails || null,\n\n      // Startup Registration & Funding\n      mca_registered: body.mcaRegistered || \"No\",\n      dpiit_registered: body.dpiitRegistered || null,\n      dpiit_details: body.dpiitDetails || null,\n      external_funding: body.externalFunding || null,\n      currently_incubated: body.currentlyIncubated || null,\n\n      // Team Members\n      team_members: body.teamMembers || \"N/A\",\n\n      // About Nirmaan Program\n      nirmaan_can_help: body.nirmaanCanHelp || \"N/A\",\n      pre_incubation_reason: body.preIncubationReason || \"N/A\",\n      heard_about_startups: body.heardAboutStartups || \"N/A\",\n      heard_about_nirmaan: body.heardAboutNirmaan || \"N/A\",\n\n      // Problem & Solution\n      problem_solving: body.problemSolving || \"N/A\",\n      your_solution: body.yourSolution || \"N/A\",\n      solution_type: body.solutionType || \"N/A\",\n\n      // Industry & Technologies\n      target_industry: body.targetIndustry || \"N/A\",\n      other_industries: otherIndustries || [],\n      industry_other: body.industryOther || null,\n      other_industries_other: body.otherIndustriesOther || null,\n      technologies_utilized: technologiesUtilized || [],\n      other_technology_details: body.otherTechnologyDetails || null,\n\n      // Startup Stage & IP\n      startup_stage: body.startupStage || \"N/A\",\n      has_intellectual_property: body.hasIntellectualProperty || \"No\",\n      has_potential_intellectual_property: body.hasPotentialIntellectualProperty || \"No\",\n\n      // Presentation & Proof\n      nirmaan_presentation_link: body.nirmaanPresentationLink || fileUrls.presentation || \"N/A\",\n      has_proof_of_concept: body.hasProofOfConcept || \"No\",\n      proof_of_concept_details: body.proofOfConceptDetails || null,\n      has_patents_or_papers: body.hasPatentsOrPapers || \"No\",\n      patents_or_papers_details: body.patentsOrPapersDetails || null,\n\n      // Seed Fund & Pitch\n      seed_fund_utilization_plan: body.seedFundUtilizationPlan || \"N/A\",\n      pitch_video_link: body.pitchVideoLink || \"N/A\",\n      document1_link: body.document1Link || fileUrls.document1 || null,\n      document2_link: body.document2Link || fileUrls.document2 || null,\n\n      // Status & Metadata\n      status: \"pending\",\n    };\n\n    const { data, error } = await supabaseServer\n      .from(\"new_application\")\n      .insert(applicationData)\n      .select()\n      .single();\n\n    if (error) {\n      console.error(\"Supabase insert error:\", error);\n      return NextResponse.json(\n        { error: \"Failed to submit application\", details: error.message },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json(\n      {\n        message: \"Application submitted successfully\",\n        data: { id: data.id, status: data.status },\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error(\"POST error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to process application\" },\n      { status: 500 }\n    );\n  }\n}\n\n/* =========================\n   GET: Fetch applications\n========================= */\nexport async function GET() {\n  try {\n    const { data, error, count } = await supabaseServer\n      .from(\"new_application\")\n      .select(\"*\", { count: \"exact\" })\n      .order(\"submitted_at\", { ascending: false });\n\n    if (error) {\n      console.error(\"Supabase fetch error:\", error);\n      return NextResponse.json(\n        { error: \"Failed to fetch applications\", details: error.message },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json(\n      {\n        applications: data || [],\n        pagination: { total: count || 0 },\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error(\"GET error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch applications\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}
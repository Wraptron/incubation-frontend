{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/brahmarishi/Repositories/nextjs/incubation-screen/frontend/app/api/evaluations/application/%5BapplicationId%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl =\n  process.env.NEXT_PUBLIC_SUPABASE_URL ||\n  \"https://dfzfmtthyvwltwwmntmd.supabase.co\";\nconst supabaseAnonKey =\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n  \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRmemZtdHRoeXZ3bHR3d21udG1kIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQwNDk0NiwiZXhwIjoyMDgzOTgwOTQ2fQ.m8DKbf04d5Awu99sYyTIpv15xvnkoXV3WTOlk4GP8HE\";\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ applicationId: string }> }\n) {\n  try {\n    // Await params in Next.js 15+\n    const resolvedParams = await params;\n    const applicationId = resolvedParams.applicationId;\n\n    console.log(\"=== Frontend API Route - GET Evaluation ===\");\n    console.log(\"Application ID from params:\", applicationId);\n    console.log(\"Params object:\", resolvedParams);\n\n    // Validate applicationId\n    const uuidRegex =\n      /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n    if (\n      !applicationId ||\n      applicationId === \"undefined\" ||\n      !uuidRegex.test(applicationId)\n    ) {\n      console.error(\"Invalid applicationId in GET route:\", applicationId);\n      return NextResponse.json(\n        { error: \"Invalid application ID\", received: applicationId },\n        { status: 400 }\n      );\n    }\n\n    // Get auth token from request\n    const authHeader = request.headers.get(\"authorization\");\n    if (!authHeader) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Create Supabase client with user's token\n    const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n      global: {\n        headers: {\n          Authorization: authHeader,\n        },\n      },\n    });\n\n    // Get current user\n    const {\n      data: { user },\n      error: userError,\n    } = await supabase.auth.getUser();\n\n    if (userError || !user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Check if user is a reviewer\n    const { data: profile } = await supabase\n      .from(\"user_profiles\")\n      .select(\"role\")\n      .eq(\"id\", user.id)\n      .single();\n\n    if (!profile || profile.role !== \"reviewer\") {\n      return NextResponse.json(\n        { error: \"Forbidden - Reviewer access required\" },\n        { status: 403 }\n      );\n    }\n\n    // Call backend API\n    const backendUrl =\n      process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5000\";\n    const response = await fetch(\n      `${backendUrl}/api/evaluations/application/${applicationId}`,\n      {\n        headers: {\n          \"x-reviewer-id\": user.id,\n        },\n      }\n    );\n\n    const data = await response.json();\n\n    if (!response.ok) {\n      return NextResponse.json(\n        { error: data.error || \"Failed to fetch evaluation\" },\n        { status: response.status }\n      );\n    }\n\n    return NextResponse.json(data);\n  } catch (error: any) {\n    console.error(\"Error fetching evaluation:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch evaluation\" },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ applicationId: string }> }\n) {\n  try {\n    // Await params in Next.js 15+\n    const resolvedParams = await params;\n    const applicationId = resolvedParams.applicationId;\n\n    console.log(\"=== Frontend API Route - PUT Evaluation ===\");\n    console.log(\"Application ID from params:\", applicationId);\n    console.log(\"Params object:\", resolvedParams);\n\n    // Validate applicationId early\n    const uuidRegex =\n      /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n    if (\n      !applicationId ||\n      applicationId === \"undefined\" ||\n      !uuidRegex.test(applicationId)\n    ) {\n      console.error(\"Invalid applicationId in PUT route:\", applicationId);\n      return NextResponse.json(\n        { error: \"Invalid application ID\", received: applicationId },\n        { status: 400 }\n      );\n    }\n\n    // Get auth token from request\n    const authHeader = request.headers.get(\"authorization\");\n    if (!authHeader) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Create Supabase client with user's token\n    const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n      global: {\n        headers: {\n          Authorization: authHeader,\n        },\n      },\n    });\n\n    // Get current user\n    const {\n      data: { user },\n      error: userError,\n    } = await supabase.auth.getUser();\n\n    if (userError || !user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Check if user is a reviewer\n    const { data: profile } = await supabase\n      .from(\"user_profiles\")\n      .select(\"role\")\n      .eq(\"id\", user.id)\n      .single();\n\n    if (!profile || profile.role !== \"reviewer\") {\n      return NextResponse.json(\n        { error: \"Forbidden - Reviewer access required\" },\n        { status: 403 }\n      );\n    }\n\n    const body = await request.json();\n\n    // Ensure user.id is valid\n    if (!user || !user.id) {\n      console.error(\"User or user.id is missing:\", { user });\n      return NextResponse.json(\n        { error: \"User ID is missing\" },\n        { status: 401 }\n      );\n    }\n\n    console.log(\"Reviewer ID:\", user.id);\n    console.log(\n      \"Backend URL:\",\n      process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5000\"\n    );\n\n    // Call backend API\n    const backendUrl =\n      process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5000\";\n    const backendEndpoint = `${backendUrl}/api/evaluations/application/${applicationId}`;\n    console.log(\"Calling backend endpoint:\", backendEndpoint);\n\n    const response = await fetch(backendEndpoint, {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-reviewer-id\": user.id,\n      },\n      body: JSON.stringify(body),\n    });\n\n    const data = await response.json();\n\n    if (!response.ok) {\n      return NextResponse.json(\n        { error: data.error || \"Failed to save evaluation\" },\n        { status: response.status }\n      );\n    }\n\n    return NextResponse.json(data);\n  } catch (error: any) {\n    console.error(\"Error saving evaluation:\", error);\n    return NextResponse.json(\n      { error: \"Failed to save evaluation\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,cACJ,QAAQ,GAAG,CAAC,wBAAwB,IACpC;AACF,MAAM,kBACJ,QAAQ,GAAG,CAAC,6BAA6B,IACzC;AAEK,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAkD;IAE1D,IAAI;QACF,8BAA8B;QAC9B,MAAM,iBAAiB,MAAM;QAC7B,MAAM,gBAAgB,eAAe,aAAa;QAElD,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,+BAA+B;QAC3C,QAAQ,GAAG,CAAC,kBAAkB;QAE9B,yBAAyB;QACzB,MAAM,YACJ;QACF,IACE,CAAC,iBACD,kBAAkB,eAClB,CAAC,UAAU,IAAI,CAAC,gBAChB;YACA,QAAQ,KAAK,CAAC,uCAAuC;YACrD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAA0B,UAAU;YAAc,GAC3D;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,2CAA2C;QAC3C,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa,iBAAiB;YAC1D,QAAQ;gBACN,SAAS;oBACP,eAAe;gBACjB;YACF;QACF;QAEA,mBAAmB;QACnB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,OAAO,SAAS,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,8BAA8B;QAC9B,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,iBACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,YAAY;YAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,aACJ,6DAAmC;QACrC,MAAM,WAAW,MAAM,MACrB,GAAG,WAAW,6BAA6B,EAAE,eAAe,EAC5D;YACE,SAAS;gBACP,iBAAiB,KAAK,EAAE;YAC1B;QACF;QAGF,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,KAAK,KAAK,IAAI;YAA6B,GACpD;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAE9B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAkD;IAE1D,IAAI;QACF,8BAA8B;QAC9B,MAAM,iBAAiB,MAAM;QAC7B,MAAM,gBAAgB,eAAe,aAAa;QAElD,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,+BAA+B;QAC3C,QAAQ,GAAG,CAAC,kBAAkB;QAE9B,+BAA+B;QAC/B,MAAM,YACJ;QACF,IACE,CAAC,iBACD,kBAAkB,eAClB,CAAC,UAAU,IAAI,CAAC,gBAChB;YACA,QAAQ,KAAK,CAAC,uCAAuC;YACrD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAA0B,UAAU;YAAc,GAC3D;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,2CAA2C;QAC3C,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa,iBAAiB;YAC1D,QAAQ;gBACN,SAAS;oBACP,eAAe;gBACjB;YACF;QACF;QAEA,mBAAmB;QACnB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,OAAO,SAAS,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,8BAA8B;QAC9B,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,iBACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,YAAY;YAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,0BAA0B;QAC1B,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE;YACrB,QAAQ,KAAK,CAAC,+BAA+B;gBAAE;YAAK;YACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,gBAAgB,KAAK,EAAE;QACnC,QAAQ,GAAG,CACT,gBACA,6DAAmC;QAGrC,mBAAmB;QACnB,MAAM,aACJ,6DAAmC;QACrC,MAAM,kBAAkB,GAAG,WAAW,6BAA6B,EAAE,eAAe;QACpF,QAAQ,GAAG,CAAC,6BAA6B;QAEzC,MAAM,WAAW,MAAM,MAAM,iBAAiB;YAC5C,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,KAAK,EAAE;YAC1B;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,KAAK,KAAK,IAAI;YAA4B,GACnD;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAE9B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}
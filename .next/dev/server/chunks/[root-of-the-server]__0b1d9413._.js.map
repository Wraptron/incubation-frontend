{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/kishoremadhavan/Desktop/Incubationn-Screen/incubation-frontend/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\n// Server-side Supabase client using the service role key so that\n// API routes can read/write tables directly without depending on the\n// separate backend service. Falls back to the public keys in case\n// environment variables are missing to keep local development working.\nconst supabaseUrl =\n  process.env.SUPABASE_URL ||\n  process.env.NEXT_PUBLIC_SUPABASE_URL ||\n  \"https://dfzfmtthyvwltwwmntmd.supabase.co\";\n\nconst supabaseServiceRoleKey =\n  process.env.SUPABASE_SERVICE_ROLE_KEY ||\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n  \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRmemZtdHRoeXZ3bHR3d21udG1kIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQwNDk0NiwiZXhwIjoyMDgzOTgwOTQ2fQ.m8DKbf04d5Awu99sYyTIpv15xvnkoXV3WTOlk4GP8HE\";\n\nexport const supabaseServer = createClient(supabaseUrl, supabaseServiceRoleKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false,\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,iEAAiE;AACjE,qEAAqE;AACrE,kEAAkE;AAClE,uEAAuE;AACvE,MAAM,cACJ,QAAQ,GAAG,CAAC,YAAY,oFAExB;AAEF,MAAM,yBACJ,QAAQ,GAAG,CAAC,yBAAyB,uQAErC;AAEK,MAAM,iBAAiB,IAAA,gMAAY,EAAC,aAAa,wBAAwB;IAC9E,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///Users/kishoremadhavan/Desktop/Incubationn-Screen/incubation-frontend/app/api/applications/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { supabaseServer } from \"@/lib/supabaseServer\";\n\n/* =========================\n   GET: List applications\n========================= */\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const statusParam = searchParams.get(\"status\");\n    const limit = Number(searchParams.get(\"limit\") ?? 50);\n    const offset = Number(searchParams.get(\"offset\") ?? 0);\n\n    let query = supabaseServer\n      .from(\"startup_applications\")\n      .select(\"*\")\n      .order(\"created_at\", { ascending: false })\n      .range(offset, offset + limit - 1);\n\n    if (statusParam && statusParam !== \"all\") {\n      query = query.eq(\"status\", statusParam);\n    }\n\n    const { data, error } = await query;\n\n    if (error) {\n      console.error(\"Supabase fetch error:\", error);\n      return NextResponse.json(\n        { error: \"Failed to fetch applications\", details: error.message },\n        { status: 500 },\n      );\n    }\n\n    const applicationIds = data?.map((app: any) => app.id) ?? [];\n    let reviewersMap: Record<string, Array<{ id: string; full_name: string | null }>> =\n      {};\n\n    if (applicationIds.length) {\n      const { data: reviewerAssignments, error: assignmentError } =\n        await supabaseServer\n          .from(\"application_reviewers\")\n          .select(\"application_id, reviewer_id\")\n          .in(\"application_id\", applicationIds);\n\n      if (!assignmentError && reviewerAssignments?.length) {\n        const reviewerIds = [\n          ...new Set(reviewerAssignments.map((r: any) => r.reviewer_id)),\n        ];\n\n        const { data: reviewers, error: reviewerError } = await supabaseServer\n          .from(\"user_profiles\")\n          .select(\"id, full_name\")\n          .in(\"id\", reviewerIds);\n\n        if (!reviewerError && reviewers) {\n          const reviewerLookup = Object.fromEntries(\n            reviewers.map((r) => [r.id, r]),\n          );\n\n          reviewerAssignments.forEach((assignment: any) => {\n            reviewersMap[assignment.application_id] ??= [];\n            const reviewer = reviewerLookup[assignment.reviewer_id];\n            if (reviewer) {\n              reviewersMap[assignment.application_id].push(reviewer);\n            }\n          });\n        }\n      }\n    }\n\n    let countQuery = supabaseServer\n      .from(\"startup_applications\")\n      .select(\"*\", { count: \"exact\", head: true });\n\n    if (statusParam && statusParam !== \"all\") {\n      countQuery = countQuery.eq(\"status\", statusParam);\n    }\n\n    const { count } = await countQuery;\n\n    const enriched = (data || []).map((app: any) => ({\n      ...app,\n      reviewers: reviewersMap[app.id] || [],\n    }));\n\n    return NextResponse.json({\n      applications: enriched,\n      pagination: {\n        total: count || 0,\n        limit,\n        offset,\n      },\n    });\n  } catch (error: any) {\n    console.error(\"Error in applications GET route:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch applications\" },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAKO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,cAAc,aAAa,GAAG,CAAC;QACrC,MAAM,QAAQ,OAAO,aAAa,GAAG,CAAC,YAAY;QAClD,MAAM,SAAS,OAAO,aAAa,GAAG,CAAC,aAAa;QAEpD,IAAI,QAAQ,yIAAc,CACvB,IAAI,CAAC,wBACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,QAAQ,SAAS,QAAQ;QAElC,IAAI,eAAe,gBAAgB,OAAO;YACxC,QAAQ,MAAM,EAAE,CAAC,UAAU;QAC7B;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;QAE9B,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAgC,SAAS,MAAM,OAAO;YAAC,GAChE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,iBAAiB,MAAM,IAAI,CAAC,MAAa,IAAI,EAAE,KAAK,EAAE;QAC5D,IAAI,eACF,CAAC;QAEH,IAAI,eAAe,MAAM,EAAE;YACzB,MAAM,EAAE,MAAM,mBAAmB,EAAE,OAAO,eAAe,EAAE,GACzD,MAAM,yIAAc,CACjB,IAAI,CAAC,yBACL,MAAM,CAAC,+BACP,EAAE,CAAC,kBAAkB;YAE1B,IAAI,CAAC,mBAAmB,qBAAqB,QAAQ;gBACnD,MAAM,cAAc;uBACf,IAAI,IAAI,oBAAoB,GAAG,CAAC,CAAC,IAAW,EAAE,WAAW;iBAC7D;gBAED,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,yIAAc,CACnE,IAAI,CAAC,iBACL,MAAM,CAAC,iBACP,EAAE,CAAC,MAAM;gBAEZ,IAAI,CAAC,iBAAiB,WAAW;oBAC/B,MAAM,iBAAiB,OAAO,WAAW,CACvC,UAAU,GAAG,CAAC,CAAC,IAAM;4BAAC,EAAE,EAAE;4BAAE;yBAAE;oBAGhC,oBAAoB,OAAO,CAAC,CAAC;wBAC3B,YAAY,CAAC,WAAW,cAAc,CAAC,KAAK,EAAE;wBAC9C,MAAM,WAAW,cAAc,CAAC,WAAW,WAAW,CAAC;wBACvD,IAAI,UAAU;4BACZ,YAAY,CAAC,WAAW,cAAc,CAAC,CAAC,IAAI,CAAC;wBAC/C;oBACF;gBACF;YACF;QACF;QAEA,IAAI,aAAa,yIAAc,CAC5B,IAAI,CAAC,wBACL,MAAM,CAAC,KAAK;YAAE,OAAO;YAAS,MAAM;QAAK;QAE5C,IAAI,eAAe,gBAAgB,OAAO;YACxC,aAAa,WAAW,EAAE,CAAC,UAAU;QACvC;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM;QAExB,MAAM,WAAW,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC,MAAa,CAAC;gBAC/C,GAAG,GAAG;gBACN,WAAW,YAAY,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE;YACvC,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,cAAc;YACd,YAAY;gBACV,OAAO,SAAS;gBAChB;gBACA;YACF;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA+B,GACxC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}
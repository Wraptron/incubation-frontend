{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/kishoremadhavan/Desktop/Wraptron-Tool/Lanchpad-Nirmaan/incubation-frontend/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\n// Server-side Supabase client using the service role key so that\n// API routes can read/write tables directly without depending on the\n// separate backend service. Falls back to the public keys in case\n// environment variables are missing to keep local development working.\nconst supabaseUrl =\n  process.env.SUPABASE_URL ||\n  process.env.NEXT_PUBLIC_SUPABASE_URL ||\n  \"https://dfzfmtthyvwltwwmntmd.supabase.co\";\n\nconst supabaseServiceRoleKey =\n  process.env.SUPABASE_SERVICE_ROLE_KEY ||\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n  \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRmemZtdHRoeXZ3bHR3d21udG1kIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQwNDk0NiwiZXhwIjoyMDgzOTgwOTQ2fQ.m8DKbf04d5Awu99sYyTIpv15xvnkoXV3WTOlk4GP8HE\";\n\nexport const supabaseServer = createClient(supabaseUrl, supabaseServiceRoleKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false,\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,iEAAiE;AACjE,qEAAqE;AACrE,kEAAkE;AAClE,uEAAuE;AACvE,MAAM,cACJ,QAAQ,GAAG,CAAC,YAAY,oFAExB;AAEF,MAAM,yBACJ,QAAQ,GAAG,CAAC,yBAAyB,uQAErC;AAEK,MAAM,iBAAiB,IAAA,0NAAY,EAAC,aAAa,wBAAwB;IAC9E,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///Users/kishoremadhavan/Desktop/Wraptron-Tool/Lanchpad-Nirmaan/incubation-frontend/app/api/applications/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { supabaseServer } from \"@/lib/supabaseServer\";\n\nconst uuidRegex =\n  /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n\nconst buildApplicationResponse = async (id: string) => {\n  const { data: application, error } = await supabaseServer\n    .from(\"new_application\")\n    .select(\"*\")\n    .eq(\"id\", id)\n    .single();\n\n  if (error || !application) {\n    return { application: null, error };\n  }\n\n  // Reviewer assignments\n  const { data: reviewerAssignments } = await supabaseServer\n    .from(\"application_reviewers\")\n    .select(\"application_id, reviewer_id\")\n    .eq(\"application_id\", id);\n\n  let reviewers: Array<{ id: string; full_name: string | null }> = [];\n  if (reviewerAssignments?.length) {\n    const reviewerIds = [\n      ...new Set(reviewerAssignments.map((r: any) => r.reviewer_id)),\n    ];\n    const { data: reviewerProfiles } = await supabaseServer\n      .from(\"user_profiles\")\n      .select(\"id, full_name\")\n      .in(\"id\", reviewerIds);\n\n    if (reviewerProfiles) {\n      const lookup = Object.fromEntries(\n        reviewerProfiles.map((r) => [r.id, r]),\n      );\n      reviewers = reviewerAssignments\n        .map((assignment) => lookup[assignment.reviewer_id])\n        .filter(Boolean);\n    }\n  }\n\n  // Evaluation stats\n  const { data: evaluations } = await supabaseServer\n    .from(\"application_evaluations\")\n    .select(\"id, reviewer_id\")\n    .eq(\"application_id\", id);\n\n  const totalReviewers = reviewers.length;\n  const evaluationsCount = evaluations?.length ?? 0;\n  const allEvaluationsComplete =\n    totalReviewers > 0 && evaluationsCount >= totalReviewers;\n\n  // Map new_application fields to old field names for frontend compatibility\n  return {\n    application: {\n      ...application,\n      // Basic mappings\n      company_name: application.team_name || application.company_name,\n      founder_name: application.your_name || application.founder_name,\n      phone: application.phone_number || application.phone,\n      created_at: application.submitted_at || application.created_at,\n      \n      // Content mappings\n      problem: application.problem_solving || application.problem,\n      solution: application.your_solution || application.solution,\n      description: application.your_solution || application.problem_solving || application.description,\n      \n      // Business mappings\n      target_market: application.target_industry || application.target_market,\n      business_model: application.solution_type || application.business_model,\n      current_traction: application.proof_of_concept_details || application.current_traction,\n      why_incubator: application.nirmaan_can_help || application.pre_incubation_reason || application.why_incubator,\n      funding_amount: application.external_funding || application.funding_amount,\n      \n      // Additional fields with fallbacks\n      website: application.website || null,\n      co_founders: application.faculty_involved || application.co_founders || null,\n      funding_stage: application.funding_stage || null,\n      \n      reviewers,\n      totalReviewers,\n      evaluationsCount,\n      allEvaluationsComplete,\n    },\n  };\n};\n\n/* =========================\n   GET: Single application\n========================= */\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> },\n) {\n  try {\n    const { id } = await params;\n\n    if (!id || !uuidRegex.test(id)) {\n      return NextResponse.json(\n        { error: \"Invalid application ID\" },\n        { status: 400 },\n      );\n    }\n\n    const { application, error } = await buildApplicationResponse(id);\n\n    if (error || !application) {\n      return NextResponse.json(\n        { error: \"Application not found\" },\n        { status: 404 },\n      );\n    }\n\n    return NextResponse.json({ application });\n  } catch (error: any) {\n    console.error(\"Error fetching application:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch application\" },\n      { status: 500 },\n    );\n  }\n}\n\n/* =========================\n   PUT: Update application\n========================= */\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> },\n) {\n  try {\n    const { id } = await params;\n\n    if (!id || !uuidRegex.test(id)) {\n      return NextResponse.json(\n        { error: \"Invalid application ID\" },\n        { status: 400 },\n      );\n    }\n\n    const body = await request.json();\n\n    // Assign reviewers\n    if (Array.isArray(body.reviewerIds)) {\n      const reviewerIds = (body.reviewerIds as Array<string>).filter(\n        (rid) => rid && uuidRegex.test(rid),\n      );\n\n      if (reviewerIds.length === 0) {\n        return NextResponse.json(\n          { error: \"Please provide at least one reviewerId\" },\n          { status: 400 },\n        );\n      }\n\n      // Replace assignments\n      await supabaseServer\n        .from(\"application_reviewers\")\n        .delete()\n        .eq(\"application_id\", id);\n\n      const { error: insertError } = await supabaseServer\n        .from(\"application_reviewers\")\n        .insert(\n          reviewerIds.map((reviewerId) => ({\n            application_id: id,\n            reviewer_id: reviewerId,\n          })),\n        );\n\n      if (insertError) {\n        return NextResponse.json(\n          { error: \"Failed to assign reviewers\", details: insertError.message },\n          { status: 500 },\n        );\n      }\n\n      // Move to under_review when reviewers get assigned\n      await supabaseServer\n        .from(\"new_application\")\n        .update({ status: \"under_review\" })\n        .eq(\"id\", id);\n    }\n\n    // Update status (including rejection reason)\n    if (body.status) {\n      const updateData: Record<string, any> = {\n        status: body.status,\n      };\n\n      if (body.status === \"rejected\") {\n        updateData.rejection_reason = body.rejectionReason || null;\n      } else if (\"rejectionReason\" in body) {\n        updateData.rejection_reason = null;\n      }\n\n      const { error: updateError } = await supabaseServer\n        .from(\"new_application\")\n        .update(updateData)\n        .eq(\"id\", id);\n\n      if (updateError) {\n        return NextResponse.json(\n          { error: \"Failed to update status\", details: updateError.message },\n          { status: 500 },\n        );\n      }\n    }\n\n    const { application } = await buildApplicationResponse(id);\n\n    return NextResponse.json({\n      message: \"Application updated successfully\",\n      application,\n    });\n  } catch (error: any) {\n    console.error(\"Error updating application:\", error);\n    return NextResponse.json(\n      { error: \"Failed to update application\" },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}